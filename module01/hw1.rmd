---
title: "DATA608_Fall 2019 Assigment One"
output:
  html_document: default
  html_notebook: default
---

**Principles of Data Visualization and Introduction to ggplot2**

I have provided you with data about the 5,000 fastest growing companies in the US, as compiled by Inc. magazine. lets read this in:

```{r}

inc <- read.csv("https://raw.githubusercontent.com/charleyferrari/CUNY_DATA_608/master/module1/Data/inc5000_data.csv", header= TRUE)

```

And lets preview this data:

```{r}

head(inc)

```
```{r}

summary(inc)

```

Think a bit on what these summaries mean. Use the space below to add some more relevant non-visual exploratory information you think helps you understand this data:

ANSWER (Part One): By using the dim function, we see that there are 5001 observations over 8 features.  The str function shows that there are 4 factor variables, two integer variables, and two numeric variables. 

```{r}
# Insert your code here, create more chunks as necessary
dim(inc)
str(inc)


```
ANSWER, Part Two: Checking for missing or incomplete data, we see 12 cases where data for the Employees feature is missing. Missing data needs to be accounted for when performing aggregate functions. 


```{r}
inc[!complete.cases(inc),]

```



```{r}

```





## Question 1

Create a graph that shows the distribution of companies in the dataset by State (ie how many are in each state). There are a lot of States, so consider which axis you should use. This visualization is ultimately going to be consumed on a 'portrait' oriented screen (ie taller than wide), which should further guide your layout choices.

```{r}

# Answer Question 1 here
suppressWarnings(suppressMessages(library("dplyr", quietly = T)))
library(dplyr)
Companies_per_State <- inc %>% 
    group_by(State) %>% 
    summarise(Companies_in_State = n()) %>% 
    arrange(Companies_in_State)
        

library(ggplot2)
#Plot saved as a separte pdf file
png(filename="DATA608_Assignment_One_Question_One.png", width=900, height=1200)
ggplot(Companies_per_State, aes(x=reorder(State, Companies_in_State), y=Companies_in_State)) +
  geom_bar(stat = "identity", fill="blue") +
  coord_flip() +
    ggtitle("Distribution of Growth Companies by State") +
    labs(y="No. of Growth COmpanies", x="State") +
    theme_classic() +
    theme(plot.title = element_text(hjust = 0.5), panel.border = element_blank()) 
    
     
    
    
```




## Quesiton 2

Lets dig in on the state with the 3rd most companies in the data set. Imagine you work for the state and are interested in how many people are employed by companies in different industries. Create a plot that shows the average and/or median employment by industry for companies in this state (only use cases with full data, use R's `complete.cases()` function.) In addition to this, your graph should show how variable the ranges are, and you should deal with outliers.


ANSWER 2 (Part One): First, remove the incomplete cases from the dataset as identified earlier.  Doing so, reduces the total number of observations down to 4,989.  Doing so increases the accuracy of the aggregate data. 

```{r}

# Answer Question 2 here

inc <- inc[complete.cases(inc),]
dim(inc)

```
ANSWER 2 (Part Two): Next,identifying the outliers in the dataset. We can see from this dot plot that there are a few huge outliers in the Employees data.

```{r}
ggplot(inc, aes(x = State, y = Employees)) +
        geom_point() +
        scale_x_discrete(name = "State") +
        scale_y_continuous(name = "Employees") +
        geom_jitter() +
        theme(axis.text.x = element_text(angle = 75, hjust = 1))
    
```

ANSWER 2 (Part Two): Next,identifying the outliers in the dataset. We can see from this dot plot that there are a few huge outliers in the Employees data. The maximum number of employees is 66,803. 

```{r}
max(inc$Employees)
min(inc$Employees)
```

ANSWER 2 (Part Three):Applying Turkey's method for identifying outliers, there are 610 data points that could be considered "Outliers" for the Employees feature. Most of these seem to be employee placement/temporary agencies. Removing these outliers shows that the data is more dispersed.


```{r}

identify_outlier <- function(datapoint) {
    q1 = 25
    q3 = 132 
    interquartile_range = q3-q1
    if (datapoint < q1-(1.5*interquartile_range) | datapoint > q3+(1.5*interquartile_range)){
        return("Outlier")
        }
    else{
          return("Acceptable")
        }
}

inc$Outlier <- sapply(inc$Employees, identify_outlier, simplify=T)
head(inc[inc$Outlier=="Outlier",])

```

```{r}
inc <- inc %>% 
        filter(Outlier != 'Outlier')
dim(inc)
```

After removing the Outliers, the dataset is reduced to 4,379 observations.



```{r}
ggplot(inc, aes(x = State, y = Employees)) +
        geom_point() +
        scale_x_discrete(name = "State") +
        scale_y_continuous(name = "Employees") +
        geom_jitter() +
        theme(axis.text.x = element_text(angle = 75, hjust = 1))
    
```

ANSWER (Part Four):  The code below confirms the visualization from Question 1 that the State with the 3rd most growth companies is NY.


```{r}
Cos_in_State <- inc %>% 
    group_by(State) %>% 
    summarise(Companies_in_State = n()) %>% 
    arrange(desc(Companies_in_State))  %>% 
    top_n(3) %>% 
    slice(3L)

Cos_in_State
```


```{r}
State_3rd_Highest <- inc %>% 
    filter(State == 'NY') %>% 
    group_by(Industry) %>% 
    summarise(Name=n(),total_emp=sum(Employees), mean_emp = mean(Employees), median_emp = median(Employees)) %>% 
    filter(Name > 4) %>% 
    arrange(desc(Name))
    

```



```{r}
State_3rd_Highest
```


```{r}
#Plot saved as a separte pdf file
png(filename="DATA608_Assignment_One_Question_Two(1).png", width=600, height=900)
ggplot(State_3rd_Highest, aes(y = mean_emp, x = reorder(Industry, mean_emp))) + 
           geom_bar(stat="identity", fill="#40b8d0") +
           theme(axis.text.x = element_text(angle = 75, hjust = 1)) +
            coord_flip() +
            ggtitle("NY: Average Number of Employees per Industry") +
            labs(y="(minimum of 5 companies per industry)", x="") +
            theme_classic() +
            theme(plot.title = element_text(hjust = 0.5), panel.border = element_blank()) 
```

```{r}
#Plot saved as a separte pdf file
png(filename="DATA608_Assignment_One_Question_Two(2).png", width=600, height=900)
ggplot(State_3rd_Highest, aes(y = median_emp, x = reorder(Industry, median_emp))) + 
           geom_bar(stat="identity", fill="#b2d183") +
            theme(axis.text.x = element_text(angle = 75, hjust = 1)) +
            coord_flip() +
            ggtitle("NY: Median Number of Employees per Industry") +
            labs(y="(minimum of 5 companies per industry)", x="") +
            theme_classic() +
            theme(plot.title = element_text(hjust = 0.5), panel.border = element_blank()) 
```

## Question 3

Now imagine you work for an investor and want to see which industries generate the most revenue per employee. Create a chart that makes this information clear. Once again, the distribution per industry should be shown.

ANSWER: First, create a new variable for each company showing revenue per employee.

```{r}
# Answer Question 3 here

inc$Rev_per_Employee <- inc$Revenue / inc$Employees
head(inc)

```
```{r}
Industry_Rev_Employee <- inc %>% 
    group_by(Industry) %>% 
    summarise(Total_Revenue=sum(Revenue), Total_Employee=sum(Employees), Industry_Revenue_perEmployee = sum(Revenue) / sum(Employees)) %>% 
    arrange(desc(Industry_Revenue_perEmployee))
Industry_Rev_Employee 
```


```{r}
labs <- c("$0", "$300K", "$600K", "$900K", "$1M")
#Plot saved as a separte pdf file
png(filename="DATA608_Assignment_One_Question_Three.png", width=600, height=900)
ggplot(Industry_Rev_Employee, aes(y = Industry_Revenue_perEmployee, x = reorder(Industry, Industry_Revenue_perEmployee))) + 
           geom_bar(stat="identity", fill="#40b8d0") +
           theme(axis.text.x = element_text(angle = 75, hjust = 1)) +
           scale_y_continuous(labels = labs) +
           coord_flip() +
           ggtitle("Industry Revenue per Employee") +
           labs(y="", x="") +
           theme_classic() +
           theme(plot.title = element_text(hjust = 0.5), panel.border = element_blank()) 
```


REFLECTION: To answer these questions, I imagined that I was talking to a group of state legislators or a Chamber of Commerce--an audience with a vested interest in the data in order to make policy. Given that I wanted the visualizations to clearly show disparities between the states when it comes to growth businesses, to show disparities between mean and median, and generated revenues per employees.  I chose bar charts to communicate these ideas and sorted them in descending orders which further communicates the information that I wanted to demonstrate. I put less emphasis on the actual hard numbers and more emphasis on showing disparties. 

